# 人生主线系统 - 完整设计文档

## 一、数据结构设计

### 1.1 顶层：人生主线（Life Threads）

**存储位置**：独立存储，不与日期绑定（可复用）

```javascript
人生主线: [
  {
    主线ID: 'thread_1', // 唯一标识
    主线名称: '', // 例如："事业突破" / "找到合适对象" / "健康管理"
    当前阶段: '', // 探索期 / 执行期 / 优化期 / 转型期
    当前关键问题: '', // 这条主线当前最需要解决的一个问题
    三个月目标: '', // 这条主线在3个月内要达到什么状态
    创建时间: '', // ISO日期字符串
    最后更新时间: '', // ISO日期字符串
    是否激活: true // 是否在当前使用
  },
  // ... 最多支持添加多条，但建议同时激活3条
]
```

**特点**：
- 支持添加、编辑、删除
- 支持"阶段性调整"（修改阶段、关键问题、目标）
- 支持"激活/停用"（停用的主线不显示在每日推进中）

---

### 1.2 每日记录结构

```javascript
{
  // 第一步：今日概览（保留）
  今日概览: {
    一句话标题: '',
    能量值: 3, // 1-5
    压力值: 3, // 1-5
    今日最关键一件事: ''
  },
  
  // 第二步：今日主线推进（核心）
  今日主线推进: {
    选择主线: [], // 数组，可以选择1-3条主线（通过主线ID引用）
    今日关键行动: '', // 今天在这条主线上，最关键的一个行动
    行动记录: '', // 具体做了什么？只写事实（200-300字）
    推进效果: 3 // 1-5，这个行动对主线推进有帮助吗？
  },
  
  // 第三步：决策与内耗（可选，但重要）
  决策与内耗: [
    {
      决策ID: 'decision_1',
      决策主题: '', // 例如："是否买车" / "是否换工作"
      带来什么: '', // 如果做这个决策，会带来什么？
      失去什么: '', // 会失去什么？
      真实痛点: '', // 我真正想解决的是什么问题？
      替代方案: '', // 有没有不通过这个决策也能解决痛点的方法？
      决策结论: '', // 最终决定是什么？为什么？
      下一步行动: '', // 如果决定做，下一步具体行动是什么？
      创建时间: '', // ISO日期字符串
      是否解决: false // 是否已经做出决策
    }
  ],
  
  // 第四步：问题库（可选）
  问题库: [
    {
      问题ID: 'problem_1',
      问题描述: '', // 今天遇到的新问题/卡点
      问题分类: '', // 技术问题 / 关系问题 / 决策问题 / 其他
      优先级: '', // P0（紧急重要）/ P1（重要不紧急）/ P2（不紧急不重要）
      是否解决: false, // 是 / 否 / 暂缓
      创建时间: '', // ISO日期字符串
      最后更新时间: '' // ISO日期字符串
    }
  ],
  
  // 第五步：习惯追踪（可选）
  习惯追踪: [
    {
      习惯ID: 'habit_1',
      习惯名称: '', // 例如："早睡早起" / "三省吾身"
      是否执行: false, // 今天是否执行
      关联主线: '', // 这个习惯是为了推进哪条主线？（主线ID）
      执行感受: '', // 今天执行这个习惯的感受如何？
      连续天数: 0 // 系统自动计算，连续执行的天数
    }
  ],
  
  // 第六步：每日三省（优化）
  每日三省: {
    动机偏差: '', // 今天有没有为了逃避/迎合而做的选择？
    理想不一致: '', // 今天有哪个瞬间和理想状态最不一致？
    主线对齐: '' // 如果明天只允许围绕三条主线各做一件小事，会选什么？
  }
}
```

---

## 二、UI流程设计

### 2.1 首次使用：主线设置页面

**触发时机**：
- 用户首次登录
- 用户主动点击"管理人生主线"

**页面内容**：
```
┌─────────────────────────────────────┐
│  设置你的人生主线（建议3条）        │
├─────────────────────────────────────┤
│                                      │
│  [主线1]                             │
│  主线名称: [输入框]                  │
│  当前阶段: [下拉：探索期/执行期...]  │
│  当前关键问题: [输入框]               │
│  三个月目标: [输入框]                │
│  [删除] [编辑]                       │
│                                      │
│  [主线2]                             │
│  ...                                 │
│                                      │
│  [主线3]                             │
│  ...                                 │
│                                      │
│  [+ 添加新主线]                      │
│                                      │
│  [保存并开始]                        │
└─────────────────────────────────────┘
```

**交互逻辑**：
- 至少需要1条主线才能开始
- 建议3条，但可以添加更多
- 支持编辑、删除、激活/停用

---

### 2.2 每日填写流程（5步）

#### Step 1: 今日概览
- 保留现有设计

#### Step 2: 今日主线推进（核心）
```
┌─────────────────────────────────────┐
│  今天推进了哪条主线？                │
├─────────────────────────────────────┤
│                                      │
│  [选择主线]（可多选，最多3条）        │
│  ☑ 主线1：事业突破                   │
│  ☐ 主线2：找到合适对象               │
│  ☐ 主线3：健康管理                   │
│                                      │
│  今日关键行动: [输入框]               │
│  "今天在这条主线上，最关键的一个行动" │
│                                      │
│  行动记录: [文本域，200-300字]        │
│  "具体做了什么？只写事实"             │
│                                      │
│  推进效果: [滑块 1-5]                │
│  "这个行动对主线推进有帮助吗？"      │
│                                      │
└─────────────────────────────────────┘
```

#### Step 3: 决策与内耗（可选）
```
┌─────────────────────────────────────┐
│  今天有什么需要决策的事情？           │
├─────────────────────────────────────┤
│                                      │
│  [+ 添加新决策]                      │
│                                      │
│  [决策1]                             │
│  决策主题: [输入框]                  │
│  带来什么: [文本域]                  │
│  失去什么: [文本域]                  │
│  真实痛点: [文本域]                  │
│  替代方案: [文本域]                  │
│  决策结论: [文本域]                  │
│  下一步行动: [输入框]                │
│  ☑ 已做出决策                        │
│  [删除]                              │
│                                      │
└─────────────────────────────────────┘
```

#### Step 4: 问题库（可选）
```
┌─────────────────────────────────────┐
│  今天遇到的新问题/卡点？             │
├─────────────────────────────────────┤
│                                      │
│  [+ 添加新问题]                      │
│                                      │
│  [问题1]                             │
│  问题描述: [输入框]                  │
│  问题分类: [下拉]                    │
│  优先级: [P0/P1/P2]                  │
│  ☐ 已解决                            │
│  [删除]                              │
│                                      │
│  [历史问题]（显示未解决的问题）       │
│  ...                                 │
│                                      │
└─────────────────────────────────────┘
```

#### Step 5: 习惯追踪（可选）
```
┌─────────────────────────────────────┐
│  今天的习惯执行情况？                 │
├─────────────────────────────────────┤
│                                      │
│  [+ 添加新习惯]                      │
│                                      │
│  [习惯1：早睡早起]                   │
│  ☑ 今天已执行                        │
│  关联主线: [下拉：选择主线]           │
│  执行感受: [输入框]                  │
│  连续天数: 5天 🔥                    │
│  [删除]                              │
│                                      │
│  [习惯2：三省吾身]                   │
│  ...                                 │
│                                      │
└─────────────────────────────────────┘
```

#### Step 6: 每日三省（优化）
- 保留现有设计，但第三问改为"主线对齐"

---

### 2.3 主线管理功能

**入口**：在Home页面顶部添加"管理主线"按钮

**功能**：
- 查看所有主线（激活/停用）
- 添加新主线
- 编辑主线（名称、阶段、关键问题、目标）
- 删除主线
- 激活/停用主线
- 查看主线历史推进情况（可选，未来功能）

---

## 三、数据存储设计

### 3.1 主线数据存储

**方案**：在Firestore中单独存储

```
users/{userId}/
  ├── lifeThreads/  // 人生主线（独立文档）
  │   └── threads: []  // 主线数组
  └── diaries/      // 每日日记
      └── {date}/   // 按日期存储
```

**数据结构**：
```javascript
// lifeThreads 文档
{
  userId: 'xxx',
  threads: [
    {
      主线ID: 'thread_1',
      主线名称: '事业突破',
      当前阶段: '执行期',
      当前关键问题: '如何提升副业收入到X',
      三个月目标: '副业月收入达到X，建立稳定客户群',
      创建时间: '2024-01-01T00:00:00.000Z',
      最后更新时间: '2024-01-15T10:30:00.000Z',
      是否激活: true
    },
    // ...
  ],
  updatedAt: '2024-01-15T10:30:00.000Z'
}
```

### 3.2 每日日记数据存储

保持现有结构，但字段改为新设计。

---

## 四、系统推荐功能（未来可做）

### 4.1 主线推进提醒
- 如果某条主线已经X天没推进，系统提醒

### 4.2 行动有效性分析
- 分析：你在这条主线上，哪些类型的行动推进效果最好？

### 4.3 决策追踪
- 追踪：你之前做的决策（比如买车），现在回头看，是否达到了预期？

### 4.4 问题库提醒
- 提醒：P0问题已经拖了X天，P1问题已经拖了X天

### 4.5 习惯连续性分析
- 显示：哪些习惯连续执行天数最长？哪些习惯对主线推进最有效？

---

## 五、实现优先级

### Phase 1: 核心功能（必须）
1. ✅ 人生主线数据结构
2. ✅ 主线设置页面
3. ✅ 今日主线推进模块
4. ✅ 每日三省优化（第三问改为"主线对齐"）

### Phase 2: 重要功能（建议）
5. ✅ 决策与内耗模块
6. ✅ 问题库模块
7. ✅ 习惯追踪模块（含连续天数统计）

### Phase 3: 优化功能（可选）
8. 主线管理功能（编辑、删除、激活/停用）
9. 系统推荐功能

---

## 六、字段详细说明

### 6.1 人生主线字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 主线ID | string | 是 | 唯一标识，格式：thread_1, thread_2... |
| 主线名称 | string | 是 | 例如："事业突破" |
| 当前阶段 | string | 是 | 探索期/执行期/优化期/转型期 |
| 当前关键问题 | string | 是 | 这条主线当前最需要解决的一个问题 |
| 三个月目标 | string | 是 | 这条主线在3个月内要达到什么状态 |
| 创建时间 | string | 是 | ISO日期字符串 |
| 最后更新时间 | string | 是 | ISO日期字符串 |
| 是否激活 | boolean | 是 | 是否在当前使用 |

### 6.2 今日主线推进字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 选择主线 | array | 是 | 数组，包含主线ID，最多3条 |
| 今日关键行动 | string | 是 | 今天在这条主线上，最关键的一个行动 |
| 行动记录 | string | 是 | 具体做了什么？只写事实（200-300字） |
| 推进效果 | number | 是 | 1-5，这个行动对主线推进有帮助吗？ |

### 6.3 决策与内耗字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 决策ID | string | 是 | 唯一标识 |
| 决策主题 | string | 是 | 例如："是否买车" |
| 带来什么 | string | 是 | 如果做这个决策，会带来什么？ |
| 失去什么 | string | 是 | 会失去什么？ |
| 真实痛点 | string | 是 | 我真正想解决的是什么问题？ |
| 替代方案 | string | 是 | 有没有不通过这个决策也能解决痛点的方法？ |
| 决策结论 | string | 否 | 最终决定是什么？为什么？ |
| 下一步行动 | string | 否 | 如果决定做，下一步具体行动是什么？ |
| 创建时间 | string | 是 | ISO日期字符串 |
| 是否解决 | boolean | 是 | 是否已经做出决策 |

### 6.4 问题库字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 问题ID | string | 是 | 唯一标识 |
| 问题描述 | string | 是 | 今天遇到的新问题/卡点 |
| 问题分类 | string | 是 | 技术问题/关系问题/决策问题/其他 |
| 优先级 | string | 是 | P0（紧急重要）/P1（重要不紧急）/P2（不紧急不重要） |
| 是否解决 | boolean | 是 | 是/否/暂缓 |
| 创建时间 | string | 是 | ISO日期字符串 |
| 最后更新时间 | string | 是 | ISO日期字符串 |

### 6.5 习惯追踪字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 习惯ID | string | 是 | 唯一标识 |
| 习惯名称 | string | 是 | 例如："早睡早起" |
| 是否执行 | boolean | 是 | 今天是否执行 |
| 关联主线 | string | 否 | 这个习惯是为了推进哪条主线？（主线ID） |
| 执行感受 | string | 否 | 今天执行这个习惯的感受如何？ |
| 连续天数 | number | 是 | 系统自动计算，连续执行的天数 |

---

## 七、UI交互细节

### 7.1 主线选择（多选）

- 显示所有激活的主线
- 支持多选，最多3条
- 如果只有1条主线，自动选中
- 如果超过3条，显示提示："建议每天聚焦1-3条主线"

### 7.2 决策框架填写

- 支持添加多个决策
- 每个决策可以标记"已做出决策"
- 已做出决策的，显示"决策结论"和"下一步行动"
- 未做出决策的，显示决策框架（带来什么/失去什么/真实痛点/替代方案）

### 7.3 问题库管理

- 显示今天新增的问题
- 显示历史未解决的问题（按优先级排序）
- P0问题用红色标识，P1用橙色，P2用灰色
- 支持标记"已解决"

### 7.4 习惯追踪

- 显示所有已创建的习惯
- 支持添加新习惯
- 显示连续天数（系统自动计算）
- 连续天数>=7天，显示🔥图标
- 支持删除习惯

---

## 八、数据迁移策略

### 8.1 旧数据兼容

- 如果用户已有旧数据，首次使用时提示"设置人生主线"
- 旧数据中的"生活/项目/情感"可以映射到新主线（用户手动选择）

### 8.2 主线初始化

- 首次使用时，提供3个默认主线模板：
  - 事业/工作主线
  - 关系/情感主线
  - 健康/生活主线
- 用户可以选择模板，也可以自定义

---

## 九、实现步骤

1. **数据结构设计** ✅（已完成）
2. **主线设置页面**（LifeThreadsSetup.vue）
3. **主线管理功能**（LifeThreadsManager.vue）
4. **今日主线推进模块**（DailyThreadProgressModule.vue）
5. **决策与内耗模块**（DecisionModule.vue）
6. **问题库模块**（ProblemLibraryModule.vue）
7. **习惯追踪模块**（HabitTrackingModule.vue）
8. **每日三省优化**（ThreeReflectionsModule.vue）
9. **数据存储函数**（firebaseStorage.js 扩展）
10. **工具函数更新**（export.js, validation.js, gamification.js）

