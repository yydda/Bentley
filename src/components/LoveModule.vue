<template>
  <div class="love-module">
    <!-- å¼•å¯¼é—®é¢˜ -->
    <div class="guide-question">
      <div class="guide-icon">ğŸ’¡</div>
      <div class="guide-text">å¼•å¯¼é—®é¢˜ï¼šä»Šå¤©æœ‰æ²¡æœ‰å“ªä¸€ä¸ªåœºæ™¯ï¼Œè®©æˆ‘è§‰å¾—"æˆ‘ä¸æ˜¯æˆ‘è‡ªå·±"ï¼Ÿ</div>
    </div>

    <div class="form-content space-y-6">
      <!-- ä¸»è¯¾é¢˜ï¼ˆå¯é€‰ï¼Œå¯å¤ç”¨ï¼‰ -->
      <el-form-item label="æƒ…æ„Ÿä¸»è¯¾é¢˜ï¼ˆé•¿æœŸï¼‰" label-width="140px">
        <el-input
          v-model="localData.ä¸»è¯¾é¢˜"
          placeholder="ä¾‹å¦‚ï¼šæˆ‘åˆ°åº•æƒ³è¦ä»€ä¹ˆæ ·çš„äº²å¯†å…³ç³»ï¼Ÿ / å¦‚ä½•å’Œçˆ¶æ¯ç›¸å¤„å¾—æ›´è½»æ¾ï¼ˆå¯é€‰ï¼Œå¯å¤ç”¨ï¼‰"
          :maxlength="100"
          show-word-limit
        />
        <div class="hint-text">å½“å‰ä¸»è¯¾é¢˜ï¼Œä¸éœ€è¦æ¯å¤©æ”¹</div>
      </el-form-item>

      <!-- ä»Šæ—¥ç„¦ç‚¹é—®é¢˜ -->
      <el-form-item label="ä»Šæ—¥æƒ…æ„Ÿç„¦ç‚¹é—®é¢˜" label-width="140px" required>
        <el-input
          v-model="localData.ä»Šæ—¥ç„¦ç‚¹é—®é¢˜"
          placeholder="ä¾‹å¦‚ï¼šä»Šå¤©æœ‰æ²¡æœ‰å“ªä¸€ä¸ªåœºæ™¯ï¼Œè®©æˆ‘è§‰å¾—&quot;æˆ‘ä¸æ˜¯æˆ‘è‡ªå·±&quot;ï¼Ÿ"
          :maxlength="100"
          show-word-limit
        />
      </el-form-item>

      <!-- ä»Šæ—¥è¡ŒåŠ¨ -->
      <el-form-item label="ä»Šæ—¥æƒ…æ„Ÿè¡ŒåŠ¨" label-width="140px" required>
        <el-input
          v-model="localData.ä»Šæ—¥è¡ŒåŠ¨"
          placeholder="ä¾‹å¦‚ï¼šç»™ç›¸äº²å¯¹è±¡å‘ä¸€æ¡çœŸè¯šçš„ä¿¡æ¯ï¼Œä¸è¯„åˆ¤ï¼Œåªè¡¨è¾¾çœŸå®æƒ³æ³• / ç»™çˆ¸å¦ˆæ‰“ä¸€ä¸ª10åˆ†é’Ÿçš„ç”µè¯ï¼Œåªå¬ä»–ä»¬è¯´"
          :maxlength="100"
          show-word-limit
        />
      </el-form-item>

      <!-- äº‹ä»¶è®°å½• -->
      <el-form-item label="æƒ…æ„Ÿäº‹ä»¶è®°å½•" label-width="140px" required>
        <el-input
          v-model="localData.äº‹ä»¶è®°å½•"
          type="textarea"
          :rows="6"
          placeholder="å‘ç”Ÿäº†ä»€ä¹ˆäº’åŠ¨ï¼Ÿæˆ‘è¡¨é¢ä¸Šæ€ä¹ˆåšçš„ï¼Ÿå†…å¿ƒçœŸå®æ„Ÿå—æ˜¯ä»€ä¹ˆï¼Ÿåªå†™äº‹å®ã€‚"
          :maxlength="300"
          show-word-limit
        />
        <div class="hint-text">200-300å­—ï¼Œåªè®°å½•äº‹å®</div>
      </el-form-item>

      <!-- åæ€ï¼šè¿èƒŒç†æƒ³è‡ªæˆ‘çš„ç¬é—´ -->
      <el-form-item label="ä»Šå¤©åœ¨å“ªä¸ªç¬é—´è¿èƒŒäº†ç†æƒ³ä¸­çš„è‡ªå·±ï¼Ÿ" label-width="140px" required>
        <el-input
          v-model="localData.åæ€_è¿èƒŒç†æƒ³è‡ªæˆ‘çš„ç¬é—´"
          type="textarea"
          :rows="3"
          placeholder="ä»Šå¤©åœ¨å“ªä¸ªç¬é—´ï¼Œæˆ‘&quot;è¿èƒŒ&quot;äº†ç†æƒ³ä¸­çš„è‡ªå·±ï¼Ÿ"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- åæ€ï¼šå¯¹è‡ªå·±è¯´å®è¯ -->
      <el-form-item label="ç”¨ä¸€å¥è¯å¯¹è‡ªå·±è¯´å®è¯" label-width="140px" required>
        <el-input
          v-model="localData.åæ€_å¯¹è‡ªå·±è¯´å®è¯"
          type="textarea"
          :rows="3"
          placeholder="å¦‚æœç”¨ä¸€å¥è¯å¯¹è‡ªå·±è¯´å®è¯ï¼Œä¼šè¯´ä»€ä¹ˆï¼Ÿ"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- åæ€ï¼šä¸‹æ¬¡å¯ä»¥å°è¯•çš„å°åŠ¨ä½œ -->
      <el-form-item label="ä¸‹ä¸€æ¬¡ç±»ä¼¼åœºæ™¯å¯ä»¥å°è¯•çš„å°åŠ¨ä½œ" label-width="140px" required>
        <el-input
          v-model="localData.åæ€_ä¸‹æ¬¡å¯ä»¥å°è¯•çš„å°åŠ¨ä½œ"
          type="textarea"
          :rows="3"
          placeholder="ä¸‹ä¸€æ¬¡ç±»ä¼¼åœºæ™¯ï¼Œæˆ‘å¯ä»¥å°è¯•çš„ä¸€ä¸ªä¸ä¸€æ ·çš„å°åŠ¨ä½œï¼Ÿ"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- æ˜æ—¥ä¸€å°æ­¥ -->
      <el-form-item label="æ˜æ—¥æƒ…æ„Ÿä¸€å°æ­¥" label-width="140px" required>
        <el-input
          v-model="localData.æ˜æ—¥ä¸€å°æ­¥"
          placeholder="ä¾‹å¦‚ï¼šç»™å¯¹è±¡å‘ä¸€æ¡ä¸è¯„åˆ¤çš„ä¿¡æ¯ï¼Œåªè¡¨è¾¾æ„Ÿå—"
          :maxlength="100"
          show-word-limit
        />
        <div class="hint-text">æ˜æ—¥æƒ…æ„Ÿæ‰¿è¯ºï¼ˆä¸€ä»¶å°äº‹ï¼‰</div>
      </el-form-item>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, onMounted } from 'vue'
import { debounce } from 'lodash'

const props = defineProps({
  modelValue: {
    type: Object,
    default: () => ({
      ä¸»è¯¾é¢˜: '',
      ä»Šæ—¥ç„¦ç‚¹é—®é¢˜: '',
      ä»Šæ—¥è¡ŒåŠ¨: '',
      äº‹ä»¶è®°å½•: '',
      åæ€_è¿èƒŒç†æƒ³è‡ªæˆ‘çš„ç¬é—´: '',
      åæ€_å¯¹è‡ªå·±è¯´å®è¯: '',
      åæ€_ä¸‹æ¬¡å¯ä»¥å°è¯•çš„å°åŠ¨ä½œ: '',
      æ˜æ—¥ä¸€å°æ­¥: ''
    })
  }
})

const emit = defineEmits(['update:modelValue', 'next', 'prev'])

// åˆå§‹åŒ–æ•°æ®ç»“æ„
function initLocalData() {
  const defaultData = {
    ä¸»è¯¾é¢˜: '',
    ä»Šæ—¥ç„¦ç‚¹é—®é¢˜: '',
    ä»Šæ—¥è¡ŒåŠ¨: '',
    äº‹ä»¶è®°å½•: '',
    åæ€_è¿èƒŒç†æƒ³è‡ªæˆ‘çš„ç¬é—´: '',
    åæ€_å¯¹è‡ªå·±è¯´å®è¯: '',
    åæ€_ä¸‹æ¬¡å¯ä»¥å°è¯•çš„å°åŠ¨ä½œ: '',
    æ˜æ—¥ä¸€å°æ­¥: ''
  }
  
  const merged = JSON.parse(JSON.stringify(defaultData))
  if (props.modelValue) {
    Object.keys(defaultData).forEach(key => {
      if (props.modelValue[key] !== undefined) {
        merged[key] = props.modelValue[key]
      }
    })
  }
  
  return merged
}

const localData = ref(initLocalData())

// ç›‘å¬æœ¬åœ°æ•°æ®å˜åŒ–ï¼Œæ›´æ–°çˆ¶ç»„ä»¶ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
const debouncedUpdateParent = debounce(() => {
  emit('update:modelValue', { ...localData.value })
}, 300)

watch(localData, () => {
  debouncedUpdateParent()
}, { deep: true })

// å½“çˆ¶ç»„ä»¶çš„modelValueå˜åŒ–æ—¶ï¼Œæ›´æ–°localData
watch(() => props.modelValue, (newVal) => {
  if (newVal) {
    Object.keys(localData.value).forEach(key => {
      if (newVal[key] !== undefined) {
        localData.value[key] = newVal[key]
      }
    })
  }
}, { deep: true })

// åˆå§‹åŒ–æ—¶ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
onMounted(() => {
  const defaultData = {
    ä¸»è¯¾é¢˜: '',
    ä»Šæ—¥ç„¦ç‚¹é—®é¢˜: '',
    ä»Šæ—¥è¡ŒåŠ¨: '',
    äº‹ä»¶è®°å½•: '',
    åæ€_è¿èƒŒç†æƒ³è‡ªæˆ‘çš„ç¬é—´: '',
    åæ€_å¯¹è‡ªå·±è¯´å®è¯: '',
    åæ€_ä¸‹æ¬¡å¯ä»¥å°è¯•çš„å°åŠ¨ä½œ: '',
    æ˜æ—¥ä¸€å°æ­¥: ''
  }
  Object.keys(defaultData).forEach(key => {
    if (localData.value[key] === undefined) {
      localData.value[key] = defaultData[key]
    }
  })
})
</script>

<style scoped>
.love-module {
  @apply space-y-6;
}

.guide-question {
  @apply flex items-center gap-3 p-4 bg-pink-50 rounded-lg border border-pink-100 mb-4;
}

.guide-icon {
  @apply text-2xl;
}

.guide-text {
  @apply text-base font-semibold text-gray-700;
}

.form-content {
  @apply bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-200/50;
}

.hint-text {
  @apply text-xs text-gray-500 mt-1;
}

:deep(.el-form-item) {
  margin-bottom: 1.5rem;
}

:deep(.el-form-item__label) {
  font-weight: 600;
  color: #374151;
  font-size: 15px;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
  .guide-question {
    @apply p-3;
  }

  .guide-text {
    @apply text-sm;
  }

  .form-content {
    @apply p-4;
  }

  :deep(.el-form-item) {
    flex-direction: column;
    align-items: flex-start;
  }

  :deep(.el-form-item__label) {
    width: 100% !important;
    margin-bottom: 8px;
    text-align: left;
  }

  :deep(.el-form-item__content) {
    width: 100%;
    margin-left: 0 !important;
  }

  :deep(.el-input__inner) {
    font-size: 16px;
    min-height: 48px;
    padding: 12px;
  }

  :deep(.el-textarea__inner) {
    font-size: 16px;
    min-height: 100px;
    padding: 12px;
  }
}
</style>
