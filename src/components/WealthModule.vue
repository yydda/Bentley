<template>
  <div class="wealth-module">
    <!-- å¼•å¯¼é—®é¢˜ -->
    <div class="guide-question">
      <div class="guide-icon">ğŸ’¡</div>
      <div class="guide-text">å¼•å¯¼é—®é¢˜ï¼šä»Šå¤©æœ€å€¼å¾—åšçš„ä¸€ä»¶"æœ‰å¤åˆ©"çš„äº‹æ˜¯ä»€ä¹ˆï¼Ÿ</div>
    </div>

    <div class="form-content space-y-6">
      <!-- ä¸»ç›®æ ‡ï¼ˆå¯é€‰ï¼Œå¯å¤ç”¨ï¼‰ -->
      <el-form-item label="è´¢å¯Œä¸»ç›®æ ‡ï¼ˆé•¿æœŸï¼‰" label-width="140px">
        <el-input
          v-model="localData.ä¸»ç›®æ ‡"
          placeholder="ä¾‹å¦‚ï¼šä¸‰å¹´å†…æŠŠå¯æ”¯é…ç°é‡‘æµåšåˆ°Xï¼Œé ä¸»èŒ+å‰¯ä¸šï¼ˆå¯é€‰ï¼Œå¯å¤ç”¨ï¼‰"
          :maxlength="100"
          show-word-limit
        />
        <div class="hint-text">é•¿æœŸç›®æ ‡ï¼Œä¸éœ€è¦æ¯å¤©æ”¹</div>
      </el-form-item>

      <!-- ä»Šæ—¥ç„¦ç‚¹é—®é¢˜ -->
      <el-form-item label="ä»Šæ—¥è´¢å¯Œç„¦ç‚¹é—®é¢˜" label-width="140px" required>
        <el-input
          v-model="localData.ä»Šæ—¥ç„¦ç‚¹é—®é¢˜"
          placeholder="ä¾‹å¦‚ï¼šä»Šå¤©æœ€å€¼å¾—åšçš„ä¸€ä»¶&quot;æœ‰å¤åˆ©&quot;çš„äº‹æ˜¯ä»€ä¹ˆï¼Ÿ"
          :maxlength="100"
          show-word-limit
        />
      </el-form-item>

      <!-- ä»Šæ—¥è¡ŒåŠ¨ + é¢„è®¡æ—¶é—´ -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <el-form-item label="ä»Šæ—¥å…³é”®è¡ŒåŠ¨ï¼ˆMIT-è´¢å¯Œï¼‰" label-width="140px" class="md:col-span-2" required>
          <el-input
            v-model="localData.ä»Šæ—¥è¡ŒåŠ¨"
            placeholder="ä¾‹å¦‚ï¼šæ•´ç†å‰¯ä¸šäº§å“çš„landing pageæ–‡æ¡ˆ"
            :maxlength="100"
            show-word-limit
          />
        </el-form-item>
        <el-form-item label="é¢„è®¡æ—¶é—´" label-width="100px">
          <div class="flex items-center gap-2">
            <el-input-number
              v-model="localData.é¢„è®¡æ—¶é—´"
              :min="0"
              :max="24"
              :precision="0.5"
              :step="0.5"
              controls-position="right"
              class="flex-1"
            />
            <span class="unit-text">å°æ—¶</span>
          </div>
        </el-form-item>
      </div>

      <!-- äº‹ä»¶è®°å½• -->
      <el-form-item label="è´¢å¯Œäº‹ä»¶è®°å½•" label-width="140px" required>
        <el-input
          v-model="localData.äº‹ä»¶è®°å½•"
          type="textarea"
          :rows="6"
          placeholder="ä»Šå¤©åšäº†å“ªäº›è·Ÿèµšé’±/æˆé•¿æœ‰å…³çš„äº‹æƒ…ï¼Ÿæœ‰æ²¡æœ‰æ‹–å»¶ã€çå¿™ï¼Ÿåªå†™äº‹å®ã€‚"
          :maxlength="300"
          show-word-limit
        />
        <div class="hint-text">200-300å­—ï¼Œåªè®°å½•äº‹å®</div>
      </el-form-item>

      <!-- åæ€ï¼šå¿™è¿˜æ˜¯åœ¨ç§¯ç´¯ -->
      <el-form-item label="ä»Šå¤©æ›´åƒæ˜¯åœ¨&quot;å¿™&quot;è¿˜æ˜¯åœ¨&quot;ç§¯ç´¯&quot;ï¼Ÿ" label-width="140px" required>
        <el-radio-group v-model="localData.åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯" class="w-full">
          <el-radio label="å¿™">å¿™</el-radio>
          <el-radio label="ç§¯ç´¯">ç§¯ç´¯</el-radio>
          <el-radio label="ä¸¤è€…éƒ½æœ‰">ä¸¤è€…éƒ½æœ‰</el-radio>
        </el-radio-group>
        <el-input
          v-if="localData.åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯"
          v-model="localData.åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯_è¯´æ˜"
          type="textarea"
          :rows="2"
          placeholder="ä¸ºä»€ä¹ˆï¼Ÿ"
          :maxlength="200"
          show-word-limit
          class="mt-2"
        />
      </el-form-item>

      <!-- åæ€ï¼šä»Šå¤©çš„æµªè´¹ -->
      <el-form-item label="ä»Šå¤©ä¸€ä¸ªå¯ä»¥é¿å…çš„æµªè´¹" label-width="140px" required>
        <el-input
          v-model="localData.åæ€_ä»Šå¤©çš„æµªè´¹"
          type="textarea"
          :rows="3"
          placeholder="æ—¶é—´/é‡‘é’±/æœºä¼šçš„æµªè´¹"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- åæ€ï¼š30å¤©æœ€æœ‰å¤åˆ©çš„ä¸€ä»¶äº‹ -->
      <el-form-item label="å¦‚æœåªé€‰ä¸€ä»¶äº‹åšæŒ30å¤©" label-width="140px" required>
        <el-input
          v-model="localData.åæ€_30å¤©æœ€æœ‰å¤åˆ©çš„ä¸€ä»¶äº‹"
          type="textarea"
          :rows="3"
          placeholder="å¯¹è´¢å¯Œæœ€æœ‰å¸®åŠ©çš„æ˜¯ä»€ä¹ˆï¼Ÿ"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- æ˜æ—¥ä¸€å°æ­¥ -->
      <el-form-item label="æ˜æ—¥è´¢å¯Œä¸€å°æ­¥" label-width="140px" required>
        <el-input
          v-model="localData.æ˜æ—¥ä¸€å°æ­¥"
          placeholder="ä¾‹å¦‚ï¼šç»™å‰¯ä¸šäº§å“å†™3æ¡ç”¨æˆ·ç—›ç‚¹æ–‡æ¡ˆè‰ç¨¿"
          :maxlength="100"
          show-word-limit
        />
        <div class="hint-text">æ˜æ—¥è´¢å¯Œæ‰¿è¯ºï¼ˆä¸€ä»¶å°äº‹ï¼‰</div>
      </el-form-item>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, onMounted } from 'vue'
import { debounce } from 'lodash'

const props = defineProps({
  modelValue: {
    type: Object,
    default: () => ({
      ä¸»ç›®æ ‡: '',
      ä»Šæ—¥ç„¦ç‚¹é—®é¢˜: '',
      ä»Šæ—¥è¡ŒåŠ¨: '',
      é¢„è®¡æ—¶é—´: 0,
      äº‹ä»¶è®°å½•: '',
      åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯: '',
      åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯_è¯´æ˜: '',
      åæ€_ä»Šå¤©çš„æµªè´¹: '',
      åæ€_30å¤©æœ€æœ‰å¤åˆ©çš„ä¸€ä»¶äº‹: '',
      æ˜æ—¥ä¸€å°æ­¥: ''
    })
  }
})

const emit = defineEmits(['update:modelValue', 'next', 'prev'])

// åˆå§‹åŒ–æ•°æ®ç»“æ„
function initLocalData() {
  const defaultData = {
    ä¸»ç›®æ ‡: '',
    ä»Šæ—¥ç„¦ç‚¹é—®é¢˜: '',
    ä»Šæ—¥è¡ŒåŠ¨: '',
    é¢„è®¡æ—¶é—´: 0,
    äº‹ä»¶è®°å½•: '',
    åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯: '',
    åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯_è¯´æ˜: '',
    åæ€_ä»Šå¤©çš„æµªè´¹: '',
    åæ€_30å¤©æœ€æœ‰å¤åˆ©çš„ä¸€ä»¶äº‹: '',
    æ˜æ—¥ä¸€å°æ­¥: ''
  }
  
  const merged = JSON.parse(JSON.stringify(defaultData))
  if (props.modelValue) {
    Object.keys(defaultData).forEach(key => {
      if (props.modelValue[key] !== undefined) {
        merged[key] = props.modelValue[key]
      }
    })
  }
  
  return merged
}

const localData = ref(initLocalData())

// ç›‘å¬æœ¬åœ°æ•°æ®å˜åŒ–ï¼Œæ›´æ–°çˆ¶ç»„ä»¶ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
const debouncedUpdateParent = debounce(() => {
  emit('update:modelValue', { ...localData.value })
}, 300)

watch(localData, () => {
  debouncedUpdateParent()
}, { deep: true })

// å½“çˆ¶ç»„ä»¶çš„modelValueå˜åŒ–æ—¶ï¼Œæ›´æ–°localData
watch(() => props.modelValue, (newVal) => {
  if (newVal) {
    Object.keys(localData.value).forEach(key => {
      if (newVal[key] !== undefined) {
        localData.value[key] = newVal[key]
      }
    })
  }
}, { deep: true })

// åˆå§‹åŒ–æ—¶ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
onMounted(() => {
  const defaultData = {
    ä¸»ç›®æ ‡: '',
    ä»Šæ—¥ç„¦ç‚¹é—®é¢˜: '',
    ä»Šæ—¥è¡ŒåŠ¨: '',
    é¢„è®¡æ—¶é—´: 0,
    äº‹ä»¶è®°å½•: '',
    åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯: '',
    åæ€_å¿™è¿˜æ˜¯åœ¨ç§¯ç´¯_è¯´æ˜: '',
    åæ€_ä»Šå¤©çš„æµªè´¹: '',
    åæ€_30å¤©æœ€æœ‰å¤åˆ©çš„ä¸€ä»¶äº‹: '',
    æ˜æ—¥ä¸€å°æ­¥: ''
  }
  Object.keys(defaultData).forEach(key => {
    if (localData.value[key] === undefined) {
      localData.value[key] = defaultData[key]
    }
  })
})
</script>

<style scoped>
.wealth-module {
  @apply space-y-6;
}

.guide-question {
  @apply flex items-center gap-3 p-4 bg-yellow-50 rounded-lg border border-yellow-100 mb-4;
}

.guide-icon {
  @apply text-2xl;
}

.guide-text {
  @apply text-base font-semibold text-gray-700;
}

.form-content {
  @apply bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-200/50;
}

.hint-text {
  @apply text-xs text-gray-500 mt-1;
}

.unit-text {
  @apply text-sm text-gray-500 whitespace-nowrap;
  min-width: 32px;
}

:deep(.el-form-item) {
  margin-bottom: 1.5rem;
}

:deep(.el-form-item__label) {
  font-weight: 600;
  color: #374151;
  font-size: 15px;
}

:deep(.el-radio-group) {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
  .guide-question {
    @apply p-3;
  }

  .guide-text {
    @apply text-sm;
  }

  .form-content {
    @apply p-4;
  }

  :deep(.el-form-item) {
    flex-direction: column;
    align-items: flex-start;
  }

  :deep(.el-form-item__label) {
    width: 100% !important;
    margin-bottom: 8px;
    text-align: left;
  }

  :deep(.el-form-item__content) {
    width: 100%;
    margin-left: 0 !important;
  }

  :deep(.el-input__inner) {
    font-size: 16px;
    min-height: 48px;
    padding: 12px;
  }

  :deep(.el-textarea__inner) {
    font-size: 16px;
    min-height: 100px;
    padding: 12px;
  }

  :deep(.el-input-number) {
    width: 100% !important;
  }

  :deep(.el-input-number__decrease),
  :deep(.el-input-number__increase) {
    width: 48px;
    height: 48px;
    font-size: 18px;
  }

  :deep(.el-radio-group) {
    flex-direction: column;
    gap: 8px;
  }
}
</style>

