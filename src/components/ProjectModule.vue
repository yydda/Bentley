<template>
  <div class="project-module">
    <!-- å¼•å¯¼é—®é¢˜ -->
    <div class="guide-question">
      <div class="guide-icon">ğŸ’¡</div>
      <div class="guide-text">å¼•å¯¼é—®é¢˜ï¼šä»Šå¤©åœ¨é¡¹ç›®ä¸Šï¼Œæœ€å…³é”®çš„ä¸€å—æ¨è¿›æ˜¯ä»€ä¹ˆï¼Ÿ</div>
    </div>

    <div class="form-content space-y-6">
      <!-- é¡¹ç›®åŸºæœ¬ä¿¡æ¯ï¼ˆå¯å¤ç”¨ï¼‰ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <el-form-item label="å½“å‰ä¸»é¡¹ç›®" label-width="140px">
          <el-input
            v-model="localData.é¡¹ç›®åç§°"
            placeholder="ä¾‹å¦‚ï¼šAI æ—¥è®°ç³»ç»Ÿ MVP / ä¸ªäººä¸»é¡µé‡æ„ï¼ˆå¯é€‰ï¼‰"
            :maxlength="100"
            show-word-limit
          />
          <div class="hint-text">å¯å¤ç”¨ï¼Œä¸éœ€è¦æ¯å¤©æ”¹</div>
        </el-form-item>
        <el-form-item label="é¡¹ç›®é˜¶æ®µ" label-width="140px">
          <el-select
            v-model="localData.é¡¹ç›®é˜¶æ®µ"
            placeholder="é€‰æ‹©é¡¹ç›®é˜¶æ®µï¼ˆå¯é€‰ï¼‰"
            class="w-full"
            clearable
          >
            <el-option label="æ¢ç´¢æœŸ" value="æ¢ç´¢æœŸ" />
            <el-option label="MVP" value="MVP" />
            <el-option label="æ‰“ç£¨æœŸ" value="æ‰“ç£¨æœŸ" />
            <el-option label="ä¸Šçº¿åè¿­ä»£" value="ä¸Šçº¿åè¿­ä»£" />
          </el-select>
        </el-form-item>
      </div>

      <!-- ä»Šæ—¥å…³é”®æ¨è¿› -->
      <el-form-item label="ä»Šæ—¥å…³é”®æ¨è¿›ï¼ˆä¸€å¥è¯ï¼‰" label-width="140px" required>
        <el-input
          v-model="localData.ä»Šæ—¥å…³é”®æ¨è¿›"
          placeholder="ä¾‹å¦‚ï¼šå®Œæˆç™»å½•æ¨¡å—å•æµ‹ / å†™å®Œé”€å”®é¡µé¢ä¸»è¦æ–‡æ¡ˆ"
          :maxlength="100"
          show-word-limit
        />
        <div class="hint-text">ä»Šå¤©è¿™ä¸ªé¡¹ç›®å¾€å‰æ¨äº†ä¸€å°æ­¥åœ¨å“ªé‡Œ</div>
      </el-form-item>

      <!-- ä»Šæ—¥é¡¹ç›®è®°å½• -->
      <el-form-item label="ä»Šæ—¥é¡¹ç›®å·¥ä½œæ¸…å•" label-width="140px" required>
        <el-input
          v-model="localData.ä»Šæ—¥é¡¹ç›®è®°å½•"
          type="textarea"
          :rows="6"
          placeholder="æŒ‰æ—¶é—´çº¿æˆ–äº‹é¡¹åˆ—å‡ºï¼šä»Šå¤©å…·ä½“åšäº†å“ªäº›å·¥ä½œï¼Ÿåªå†™äº‹å®ï¼Œä¸è¯„ä»·ã€‚ä¾‹å¦‚ï¼š10:00-11:30 é‡æ„ Home é¡µé¢è¡¨å•ç»“æ„ / 15:00-16:00 è°ƒè¯• Firebase å­˜å‚¨é—®é¢˜"
          :maxlength="500"
          show-word-limit
        />
        <div class="hint-text">å»ºè®® 200-300 å­—ï¼Œè®°å½•å®¢è§‚å·¥ä½œè¿‡ç¨‹</div>
      </el-form-item>

      <!-- ä»Šæ—¥é¡¹ç›®äº§å‡ºï¼ˆå¯é€‰ï¼‰ -->
      <el-form-item label="ä»Šæ—¥é¡¹ç›®äº§å‡ºï¼ˆå¯é€‰ï¼‰" label-width="140px">
        <el-input
          v-model="localData.ä»Šæ—¥é¡¹ç›®äº§å‡º"
          type="textarea"
          :rows="3"
          placeholder="ä»Šå¤©æœ‰å“ªäº›çœ‹å¾—è§çš„äº§å‡ºï¼Ÿä¾‹å¦‚ï¼šå®Œæˆç™»å½•æ¨¡å—å•æµ‹ / å†™å®Œ 1 ç¯‡åŠŸèƒ½ä»‹ç»æ–‡æ¡ˆ / æ­å¥½éƒ¨ç½²æµæ°´çº¿é›å½¢"
          :maxlength="300"
          show-word-limit
        />
      </el-form-item>

      <!-- é¡¹ç›®è¿›åº¦æ„Ÿ -->
      <el-form-item label="é¡¹ç›®è¿›åº¦æ„Ÿï¼ˆ0-100%ï¼‰" label-width="140px" required>
        <div class="flex items-center gap-4">
          <el-slider
            v-model="localData.é¡¹ç›®è¿›åº¦æ„Ÿ"
            :min="0"
            :max="100"
            :step="5"
            show-stops
            show-input
            class="flex-1"
          />
          <span class="text-sm text-gray-600 min-w-[60px]">{{ localData.é¡¹ç›®è¿›åº¦æ„Ÿ }}%</span>
        </div>
        <div class="hint-text">è¿™ä¸ªé¡¹ç›®ç¦»é˜¶æ®µç›®æ ‡è¿˜æœ‰å¤šè¿œï¼Ÿ</div>
      </el-form-item>

      <!-- æœ€æœ‰æ•ˆåŠ¨ä½œ -->
      <el-form-item label="ä»Šå¤©æœ€æœ‰æ•ˆçš„ä¸€ä¸ªåŠ¨ä½œ" label-width="140px" required>
        <el-input
          v-model="localData.æœ€æœ‰æ•ˆåŠ¨ä½œ"
          type="textarea"
          :rows="3"
          placeholder="ä¾‹å¦‚ï¼šå’ŒçœŸå®ç”¨æˆ·èŠäº† 30 åˆ†é’Ÿéœ€æ±‚ / æŠŠé˜»å¡äº†ä¸‰å¤©çš„ bug è§£å†³æ‰äº†"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- ä»Šæ—¥æµªè´¹ -->
      <el-form-item label="ä»Šå¤©æœ€æ²¡å¿…è¦çš„ä¸€ä»¶äº‹" label-width="140px" required>
        <el-input
          v-model="localData.ä»Šæ—¥æµªè´¹"
          type="textarea"
          :rows="3"
          placeholder="ä¾‹å¦‚ï¼šèŠ± 1 å°æ—¶çº ç»“æŒ‰é’®é¢œè‰² / é‡æ„äº†æš‚æ—¶ç”¨ä¸åˆ°çš„éƒ¨åˆ†"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- å¡ç‚¹ä¸ç–‘é—® -->
      <el-form-item label="å¡ç‚¹ä¸æœªè§£å†³é—®é¢˜" label-width="140px" required>
        <el-input
          v-model="localData.å¡ç‚¹ä¸ç–‘é—®"
          type="textarea"
          :rows="3"
          placeholder="ä»Šå¤©å¡åœ¨å“ªé‡Œï¼Ÿæœ‰å“ªäº›è¿˜æƒ³ä¸æ˜ç™½çš„é—®é¢˜ï¼Ÿ"
          :maxlength="300"
          show-word-limit
        />
      </el-form-item>

      <!-- æ˜æ—¥ä»»åŠ¡åˆ—è¡¨ -->
      <el-form-item label="æ˜æ—¥é¡¹ç›®ä»»åŠ¡ï¼ˆ1-3ä¸ªï¼‰" label-width="140px" required>
        <el-input
          v-model="localData.æ˜æ—¥ä»»åŠ¡åˆ—è¡¨"
          type="textarea"
          :rows="4"
          placeholder="æ¯è¡Œä¸€ä¸ªï¼Œå†™å¾—è¶³å¤Ÿå…·ä½“ï¼š&#10;1ï¼‰ç»™æ—¥è®°ç³»ç»ŸåŠ é¡¹ç›®æ¨¡å—å­—æ®µå¹¶ä¿å­˜åˆ° Firebase&#10;2ï¼‰å†™ 500 å­—é¡¹ç›®è¯´æ˜æ–‡æ¡£&#10;3ï¼‰çº¦ç¬¬ä¸€æ‰¹å†…æµ‹ç”¨æˆ·"
          :maxlength="500"
          show-word-limit
        />
        <div class="hint-text">åªå†™ä½ æ˜å¤©çœŸçš„ä¼šåšçš„ 1-3 ä»¶äº‹</div>
      </el-form-item>

      <!-- æ˜æ—¥ä¼˜å…ˆçº§ç†ç”±ï¼ˆå¯é€‰ï¼‰ -->
      <el-form-item label="æ˜æ—¥ä¼˜å…ˆçº§è¯´æ˜ï¼ˆå¯é€‰ï¼‰" label-width="140px">
        <el-input
          v-model="localData.æ˜æ—¥ä¼˜å…ˆçº§ç†ç”±"
          type="textarea"
          :rows="2"
          placeholder="ä¾‹å¦‚ï¼šè¿™ä¸‰ä¸ªä»»åŠ¡å®Œæˆåï¼Œå°±å¯ä»¥çº¦ç¬¬ä¸€æ‰¹å†…æµ‹ç”¨æˆ·äº†"
          :maxlength="200"
          show-word-limit
        />
      </el-form-item>

      <!-- æ˜æ—¥é£é™©ä¸å‡†å¤‡ï¼ˆå¯é€‰ï¼‰ -->
      <el-form-item label="æ˜æ—¥é£é™©ä¸å¯¹ç­–ï¼ˆå¯é€‰ï¼‰" label-width="140px">
        <el-input
          v-model="localData.æ˜æ—¥é£é™©ä¸å‡†å¤‡"
          type="textarea"
          :rows="3"
          placeholder="ä¾‹å¦‚ï¼šç™½å¤©ä¼šè®®å¤š â†’ ä¸Šåˆåªåš 1 ä¸ªæœ€é‡è¦ä»»åŠ¡ / å¯¹ XX æŠ€æœ¯ä¸ç†Ÿ â†’ å…ˆçœ‹ 30 åˆ†é’Ÿå®˜æ–¹æ–‡æ¡£"
          :maxlength="300"
          show-word-limit
        />
      </el-form-item>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, onMounted } from 'vue'
import { debounce } from 'lodash'

const props = defineProps({
  modelValue: {
    type: Object,
    default: () => ({
      é¡¹ç›®åç§°: '',
      é¡¹ç›®é˜¶æ®µ: '',
      ä»Šæ—¥å…³é”®æ¨è¿›: '',
      ä»Šæ—¥é¡¹ç›®è®°å½•: '',
      ä»Šæ—¥é¡¹ç›®äº§å‡º: '',
      é¡¹ç›®è¿›åº¦æ„Ÿ: 0,
      æœ€æœ‰æ•ˆåŠ¨ä½œ: '',
      ä»Šæ—¥æµªè´¹: '',
      å¡ç‚¹ä¸ç–‘é—®: '',
      æ˜æ—¥ä»»åŠ¡åˆ—è¡¨: '',
      æ˜æ—¥ä¼˜å…ˆçº§ç†ç”±: '',
      æ˜æ—¥é£é™©ä¸å‡†å¤‡: ''
    })
  }
})

const emit = defineEmits(['update:modelValue', 'next', 'prev'])

// åˆå§‹åŒ–æ•°æ®ç»“æ„
function initLocalData() {
  const defaultData = {
    é¡¹ç›®åç§°: '',
    é¡¹ç›®é˜¶æ®µ: '',
    ä»Šæ—¥å…³é”®æ¨è¿›: '',
    ä»Šæ—¥é¡¹ç›®è®°å½•: '',
    ä»Šæ—¥é¡¹ç›®äº§å‡º: '',
    é¡¹ç›®è¿›åº¦æ„Ÿ: 0,
    æœ€æœ‰æ•ˆåŠ¨ä½œ: '',
    ä»Šæ—¥æµªè´¹: '',
    å¡ç‚¹ä¸ç–‘é—®: '',
    æ˜æ—¥ä»»åŠ¡åˆ—è¡¨: '',
    æ˜æ—¥ä¼˜å…ˆçº§ç†ç”±: '',
    æ˜æ—¥é£é™©ä¸å‡†å¤‡: ''
  }
  
  const merged = JSON.parse(JSON.stringify(defaultData))
  if (props.modelValue) {
    Object.keys(defaultData).forEach(key => {
      if (props.modelValue[key] !== undefined) {
        merged[key] = props.modelValue[key]
      }
    })
  }
  
  return merged
}

const localData = ref(initLocalData())

// ç›‘å¬æœ¬åœ°æ•°æ®å˜åŒ–ï¼Œæ›´æ–°çˆ¶ç»„ä»¶ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
const debouncedUpdateParent = debounce(() => {
  emit('update:modelValue', { ...localData.value })
}, 300)

watch(localData, () => {
  debouncedUpdateParent()
}, { deep: true })

// å½“çˆ¶ç»„ä»¶çš„modelValueå˜åŒ–æ—¶ï¼Œæ›´æ–°localData
watch(() => props.modelValue, (newVal) => {
  if (newVal) {
    Object.keys(localData.value).forEach(key => {
      if (newVal[key] !== undefined) {
        localData.value[key] = newVal[key]
      }
    })
  }
}, { deep: true })

// åˆå§‹åŒ–æ—¶ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
onMounted(() => {
  const defaultData = {
    é¡¹ç›®åç§°: '',
    é¡¹ç›®é˜¶æ®µ: '',
    ä»Šæ—¥å…³é”®æ¨è¿›: '',
    ä»Šæ—¥é¡¹ç›®è®°å½•: '',
    ä»Šæ—¥é¡¹ç›®äº§å‡º: '',
    é¡¹ç›®è¿›åº¦æ„Ÿ: 0,
    æœ€æœ‰æ•ˆåŠ¨ä½œ: '',
    ä»Šæ—¥æµªè´¹: '',
    å¡ç‚¹ä¸ç–‘é—®: '',
    æ˜æ—¥ä»»åŠ¡åˆ—è¡¨: '',
    æ˜æ—¥ä¼˜å…ˆçº§ç†ç”±: '',
    æ˜æ—¥é£é™©ä¸å‡†å¤‡: ''
  }
  Object.keys(defaultData).forEach(key => {
    if (localData.value[key] === undefined) {
      localData.value[key] = defaultData[key]
    }
  })
})
</script>

<style scoped>
.project-module {
  @apply space-y-6;
}

.guide-question {
  @apply flex items-center gap-3 p-4 bg-yellow-50 rounded-lg border border-yellow-100 mb-4;
}

.guide-icon {
  @apply text-2xl;
}

.guide-text {
  @apply text-base font-semibold text-gray-700;
}

.form-content {
  @apply bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-200/50;
}

.hint-text {
  @apply text-xs text-gray-500 mt-1;
}

:deep(.el-form-item) {
  margin-bottom: 1.5rem;
}

:deep(.el-form-item__label) {
  font-weight: 600;
  color: #374151;
  font-size: 15px;
}

:deep(.el-slider) {
  margin: 0;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
  .guide-question {
    @apply p-3;
  }

  .guide-text {
    @apply text-sm;
  }

  .form-content {
    @apply p-4;
  }

  :deep(.el-form-item) {
    flex-direction: column;
    align-items: flex-start;
  }

  :deep(.el-form-item__label) {
    width: 100% !important;
    margin-bottom: 8px;
    text-align: left;
  }

  :deep(.el-form-item__content) {
    width: 100%;
    margin-left: 0 !important;
  }

  :deep(.el-input__inner) {
    font-size: 16px;
    min-height: 48px;
    padding: 12px;
  }

  :deep(.el-textarea__inner) {
    font-size: 16px;
    min-height: 100px;
    padding: 12px;
  }

  :deep(.el-slider__runway) {
    margin: 10px 0;
  }
}
</style>

